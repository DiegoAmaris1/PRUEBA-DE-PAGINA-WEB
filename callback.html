<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>LinkedIn Login Callback</title>
</head>
<body style="font-family:Arial; padding:40px;">

<script>
(async () => {
    console.log("➡ Procesando respuesta del backend...");

    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");
    const state = params.get("state");

    if (!code) {
        document.body.innerHTML = "<h2>Error: No llegó ningún código</h2>";
        return;
    }

    // ----- TU URL DE APPS SCRIPT -----
    const BACKEND_URL = 
        "https://script.google.com/macros/s/AKfycbzs4LKQGD95fCAmyoAr-R_puIATBtujeG_sdNB5eKDZTHABEjoO1a720RktxEunvak/exec";

    // ----- SOLICITAR JSON AL BACKEND -----
    const response = await fetch(`${BACKEND_URL}?code=${code}&state=${state}`);
    const data = await response.json();

    console.log("Respuesta recibida:", data);

    if (!data.ok) {
        document.body.innerHTML = "<h2>Error en autenticación</h2>";
        return;
    }

    // ----- GUARDAR DATOS EN LOCALSTORAGE -----
    localStorage.setItem("usuario", JSON.stringify(data.user));

    // ----- REDIRIGIR A TU INDEX LOCAL -----
    window.location.href = "http://localhost/1.Consultoria Contable y Financiera Diego Amaris/index.html";

})();
</script>

<h3>Procesando inicio de sesión...</h3>
<p>Espera un momento...</p>

</body>
</html>
